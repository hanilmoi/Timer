<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hanil Timer</title>
    
    <link rel="icon" href="/Timer/favicon.ico" type="image/x-icon" />
    <link rel="manifest" href="/Timer/manifest.json" />

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Anonymous+Pro&family=Nanum+Myeongjo&display=swap" rel="stylesheet">

    <!-- Tailwind Custom Font & Color ì„¤ì • -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        Inter: ['Inter', 'sans-serif'],
                        Anonymous_Pro: ['"Anonymous Pro"', 'monospace'],
                        NanumMyeongjo: ['"Nanum Myeongjo"', 'serif']
                    },
                    colors: {
                        hanilgreen: "#00AF84",
                        graylight: "#F0F0F0",
                        graymid: "#DFDFDF",
                        graybg: "#F7F7F7",
                        darkgray: "#444444"
                    }
                }
            }
        }
    </script>
    <style>
        #fillCircle {
            background: conic-gradient(#f0f0f0 0%, #CFDFFF 0%);
            transition: background 1s linear;
        }
    
        .fade-slide-enter {
            transform: translateY(100%);
            opacity: 0;
        }
    
        .fade-slide-enter-active {
            transform: translateY(0);
            opacity: 1;
            transition: transform 0.4s ease, opacity 0.4s ease;
        }
    
        .fade-slide-leave {
            transform: translateY(0);
            opacity: 1;
        }
    
        .fade-slide-leave-active {
            transform: translateY(100%);
            opacity: 0;
            transition: transform 0.4s ease, opacity 0.4s ease;
        }
        
        #timeSettingLayer {
            /* top-1/2 left-1/2 ëŒ€ì‹  bottom: 0, left: 50% ì‚¬ìš© */
            position: fixed;
            width: 540px;
            height: 441px;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) translateY(100%);
            opacity: 0;
            border-radius: 20px 20px 0 0;
            background: #f0f0f0;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
            transition: transform 0.4s ease, opacity 0.4s ease;
            z-index: 50;
        }
    
        /* show ìƒíƒœì¼ ë•Œ */
        #timeSettingLayer.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
    </style>
</head>

<body class="bg-white font-Inter">

    <!-- ì‚¬ì´ë“œë°” -->
    <aside class="fixed left-0 top-0 w-[180px] h-screen bg-white border-r border-graymid p-6 flex flex-col justify-between">
        <div>
            <h1 class="text-black text-xl font-semibold mb-10 leading-[30px]">HANIL TIMER</h1>
            <nav class="space-y-2">
                <div class="px-2 h-10 flex items-center gap-4">
                    <span class="text-black text-base font-semibold">Features</span>
                </div>
                <a href="index.html" class="block px-2 h-10 flex items-center gap-4 hover:bg-graybg rounded-lg">
                    <img src="/Timer/images/PracticeExamTimer.png" alt="ëª¨ì˜ê³ ì‚¬ ì•„ì´ì½˜" class="w-[25px] h-[25px]" />
                    <span class="text-black text-base font-medium">ëª¨ì˜ê³ ì‚¬</span>
                </a>
                <a href="stopwatch.html" class="block px-2 h-10 flex items-center gap-4 hover:bg-graybg rounded-lg">
                    <img src="/Timer/images/Stopwatch.png" alt="ìŠ¤í†±ì›Œì¹˜ ì•„ì´ì½˜" class="w-[25px] h-[26px]" />
                    <span class="text-black text-base font-medium">ìŠ¤í†±ì›Œì¹˜</span>
                </a>
                <div class="px-2 h-10 flex items-center gap-4 bg-graybg rounded-lg">
                    <img src="/Timer/images/Timer.png" alt="íƒ€ì´ë¨¸ ì•„ì´ì½˜" class="w-[25px] h-[25px]" />
                    <span class="text-black text-base font-medium">íƒ€ì´ë¨¸</span>
                </div>
            </nav>
        </div>
        <div class="mt-4">
            <label for="alarmFileInput" class="text-black text-sm font-medium block mb-1">ğŸ”” ì•ŒëŒ ì†Œë¦¬ ì„ íƒ</label>
            <input type="file" id="alarmFileInput" accept="audio/*" class="text-sm w-full" />
        </div>
    </aside>
    
    <!-- ìƒë‹¨ë°” -->
    <header class="ml-[180px] w-[906px] h-[197px] p-8">
        <div class="flex justify-between items-center mb-8">
            <div class="flex space-x-2 bg-graybg p-1 rounded-lg" id="changeButtons">
                <!-- ë³€ê²½ ë²„íŠ¼ : data-change, data-time(ì´ˆ) -->
                <div class="change-btn px-3 h-8 bg-white rounded-lg shadow flex items-center text-black text-base font-medium cursor-pointer"
                     data-change="íƒ€ì´ë¨¸1" data-time="10">íƒ€ì´ë¨¸1</div>
                <div class="change-btn px-3 h-8 flex items-center text-black text-base font-medium cursor-pointer"
                     data-change="íƒ€ì´ë¨¸2" data-time="20">íƒ€ì´ë¨¸2</div>
                <div class="change-btn px-3 h-8 flex items-center text-black text-base font-medium cursor-pointer"
                     data-change="íƒ€ì´ë¨¸3" data-time="30">íƒ€ì´ë¨¸3</div>
            </div>
            <div class="h-10 px-4 bg-black text-white text-base font-medium rounded-lg flex items-center">for Hanil High</div>
        </div>
        <div>
            <h2 class="text-black text-[34px] font-semibold leading-[37.40px]">íƒ€ì´ë¨¸</h2>
            <p class="text-darkgray text-base font-normal">Timer</p>
        </div>
    </header>

    <!-- ë©”ì¸ íƒ€ì´ë¨¸ ì˜ì—­ -->
    <main class="ml-[174px] w-[906px] flex justify-center items-center h-[400px] relative">
        <section data-layer="Clock" class="Clock w-[566px] h-[250px] relative overflow-hidden">
            <div data-layer="ê³¼ëª©ë³„ íƒ€ì´ë¨¸" class="w-[250px] h-[250px] absolute left-[158px] top-0">
                <!-- í”„ë¡œê·¸ë ˆìŠ¤ ë°°ê²½ -->
                <div id="progressCircle" class="w-full h-full rounded-full relative">
                    <!-- ì§„í–‰ ì±„ìš°ê¸° ì› -->
                    <div id="fillCircle" class="absolute inset-0 rounded-full bg-[conic-gradient(#f0f0f0_0%,#00af84_0%)] transition-background duration-1000 ease-linear"></div>
                    <!-- ì¤‘ì•™ í°ìƒ‰ ì› (ì…ì²´ê° íš¨ê³¼) -->
                    <div class="absolute inset-[15.62px] rounded-full bg-white shadow-[inset_0px_4px_10px_0px_rgba(0,0,0,0.25)]"></div>
                </div>
            </div>

            <!-- Reset ë²„íŠ¼ -->
            <button id="resetButton" aria-label="íƒ€ì´ë¨¸ ì´ˆê¸°í™”" class="w-[100px] h-[100px] absolute left-[466px] top-[65px] cursor-pointer">
                <div class="w-full h-full bg-[#f0f0f0] rounded-full shadow-[inset_0px_1px_10px_0px_rgba(0,0,0,0.25)]"></div>
                <img src="/Timer/images/Reset.png" alt="ë¦¬ì…‹ ì•„ì´ì½˜" class="w-[41.67px] h-[41.67px] absolute left-[29px] top-[29px]" />
            </button>

            <!-- Play ë²„íŠ¼ -->
            <button id="playButton" aria-label="íƒ€ì´ë¨¸ ì‹œì‘" class="w-[100px] h-[100px] absolute left-0 top-[65px] cursor-pointer">
                <div class="w-full h-full bg-[#f0f0f0] rounded-full shadow-[inset_0px_1px_10px_0px_rgba(0,0,0,0.25)]"></div>
                <img src="/Timer/images/Play.png" alt="í”Œë ˆì´ ì•„ì´ì½˜" class="w-[41.67px] h-[41.67px] absolute left-[33px] top-[29px]" />
            </button>

            <!-- Stop ë²„íŠ¼ -->
            <button id="stopButton" aria-label="íƒ€ì´ë¨¸ ì •ì§€" class="w-[100px] h-[100px] absolute left-0 top-[65px] cursor-pointer hidden">
                <div class="w-full h-full bg-[#f0f0f0] rounded-full shadow-[inset_0px_1px_10px_0px_rgba(0,0,0,0.25)]"></div>
                <img src="/Timer/images/Stop.png" alt="ìŠ¤í†± ì•„ì´ì½˜" class="w-[33.33px] h-[33.33px] absolute left-[33px] top-[33px]" />
            </button>

            <!-- ì‹œê°„ í‘œì‹œ -->
            <div class="timer-text text-center justify-center text-black text-[40px] font-normal font-['Anonymous_Pro'] leading-[60px]"
                 style="position: relative; z-index: 10; cursor: pointer;">
                00:00:00
            </div>
        </section>

        <div class="fixed bottom-4 right-4 text-black text-xl font-NanumMyeongjo whitespace-nowrap">
            í•œì¼ê³ ë“±í•™êµ í•™ìƒìì¹˜ì •ë¶€ ì •ë³´ë¶€
        </div>

        <!-- ê²€ì • ë°°ê²½ ì˜¤ë²„ë ˆì´ -->
        <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-40"></div>

        <div id="timeSettingLayer" class="fixed w-[540px] h-[441px] rounded-[20px] bg-[#f0f0f0] shadow-lg z-50">
                <!-- ë°°ê²½ ë° ì œëª© -->
                <div class="Rectangle1 w-[540px] h-[574px] left-0 top-0 absolute bg-[#f0f0f0] rounded-[20px]"></div>
                <div class="Title left-[50px] top-[50px] absolute inline-flex flex-col justify-start items-start gap-2">
                    <div class="text-black text-[34px] font-semibold font-['Inter'] leading-[37.40px]">ì‹œê°„ ì„¤ì •</div>
                    <div class="text-[#444444] text-base font-normal font-['Inter'] leading-normal">Time Setting</div>
                </div>
                
                <!-- ì‹œ(hour) ê·¸ë£¹ -->
                <div data-group="hour" class="absolute left-[50px] top-[183px]">
                    <div class="text-center text-[#444444] text-base font-normal font-['Inter'] leading-normal">hour</div>
                    <div class="w-[120px] h-20 mt-1 bg-[#d9d9d9] rounded-[20px] shadow-[inset_0px_2px_4px_rgba(0,0,0,0.25)]"></div>
                    <div class="absolute top-[28px] left-[37px] text-black text-5xl font-normal font-['Anonymous_Pro'] leading-[72px]">00</div>
                </div>
                
                <!-- ì²« ë²ˆì§¸ ì½œë¡  -->
                <div class="absolute left-[181px] top-[191px] text-black text-[64px] font-normal font-['Inter'] leading-[96px]">:</div>
                
                <!-- ë¶„(min) ê·¸ë£¹ -->
                <div data-group="minute" class="absolute left-[210px] top-[183px]">
                    <div class="text-center text-[#444444] text-base font-normal font-['Inter'] leading-normal">min</div>
                    <div class="w-[120px] h-20 mt-1 bg-[#d9d9d9] rounded-[20px] shadow-[inset_0px_2px_4px_rgba(0,0,0,0.25)]"></div>
                    <div class="absolute top-[28px] left-[37px] text-black text-5xl font-normal font-['Anonymous_Pro'] leading-[72px]">00</div>
                </div>
                
                <!-- ë‘ ë²ˆì§¸ ì½œë¡  -->
                <div class="absolute left-[341px] top-[191px] text-black text-[64px] font-normal font-['Inter'] leading-[96px]">:</div>
                
                <!-- ì´ˆ(sec) ê·¸ë£¹ -->
                <div data-group="second" class="absolute left-[370px] top-[183px]">
                    <div class="text-center text-[#444444] text-base font-normal font-['Inter'] leading-normal">sec</div>
                    <div class="w-[120px] h-20 mt-1 bg-[#d9d9d9] rounded-[20px] shadow-[inset_0px_2px_4px_rgba(0,0,0,0.25)]"></div>
                    <div class="absolute top-[28px] left-[37px] text-black text-5xl font-normal font-['Anonymous_Pro'] leading-[72px]">00</div>
                </div>
                
                <!-- í™•ì¸ ë²„íŠ¼ ê·¸ë£¹ -->
                <div data-group="confirm" class="absolute left-[220px] top-[337px]">
                    <div class="w-[100px] h-10 bg-[#cfdfff] rounded-[10px]"></div>
                    <div class="absolute top-[8px] left-[35px] text-center text-[#444444] text-base font-normal font-['Inter'] leading-normal">í™•ì¸</div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const timerDisplay = document.querySelector(".timer-text");
        const playButton = document.getElementById("playButton");
        const stopButton = document.getElementById("stopButton");
        const resetButton = document.getElementById("resetButton");
        const fillCircle = document.getElementById("fillCircle");
        const alarmInput = document.getElementById("alarmFileInput");
        const timerText = document.querySelector(".timer-text");
        
        const overlay = document.getElementById("overlay");
        const timeSettingLayer = document.getElementById("timeSettingLayer");
        const confirmBtn = timeSettingLayer.querySelector("[data-group='confirm']");
        const hourBox = timeSettingLayer.querySelector("[data-group='hour'] .text-5xl");
        const minuteBox = timeSettingLayer.querySelector("[data-group='minute'] .text-5xl");
        const secondBox = timeSettingLayer.querySelector("[data-group='second'] .text-5xl");

        function openTimeSetting() {
            hourBox.textContent = "00";
            minuteBox.textContent = "00";
            secondBox.textContent = "00";
            
            overlay.classList.remove("hidden");
            setTimeout(() => {
                overlay.style.opacity = "1";
                timeSettingLayer.classList.add("show");
            }, 10);
        }
        
        function closeTimeSetting() {
            overlay.style.opacity = "0";
            timeSettingLayer.classList.remove("show");
            setTimeout(() => {
                overlay.classList.add("hidden");
            }, 400);
        }

        // ì‹œê°„ í‘œì‹œ í´ë¦­ ì‹œ ë ˆì´ì–´ ì—´ê¸°
        timerText.addEventListener("click", openTimeSetting);
        
        // í™•ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ ë ˆì´ì–´ ë‹«ê¸°
        confirmBtn.addEventListener("click", () => {
            closeTimeSetting();
    
            // ì„¤ì •ê°’ ì ìš©
            const h = parseInt(hourBox.textContent) || 0;
            const m = parseInt(minuteBox.textContent) || 0;
            const s = parseInt(secondBox.textContent) || 0;
            const total = h * 3600 + m * 60 + s;
    
            if (total > 0) {
                totalTime = total;
                timeLeft = total;
                updateDisplay();
                changeStates[currentChange].timeLeft = timeLeft;
            }
        });

        // ë°°ê²½ ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œ ë ˆì´ì–´ ë‹«ê¸°
        overlay.addEventListener("click", closeTimeSetting);

        // ìˆ«ì í´ë¦­ ì‹œ ê°’ ì…ë ¥
        function setupEditableTimeBox(box, label) {
            box.style.cursor = "pointer";
            box.addEventListener("click", () => {
                const input = prompt(`${label} ê°’ì„ ì…ë ¥í•˜ì„¸ìš” (${label === "ì‹œ" ? "0~99" : "0~59"}):`, box.textContent);
                if (input !== null) {
                    const num = parseInt(input);
                    const max = label === "ì‹œ" ? 99 : 59;
                    if (!isNaN(num) && num >= 0 && num <= max) {
                        box.textContent = String(num).padStart(2, '0');
                    } else {
                        alert(`âŒ ${label}ëŠ” 0~${max} ì‚¬ì´ì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.`);
                    }
                }
            });
        }

        setupEditableTimeBox(hourBox, "ì‹œ");
        setupEditableTimeBox(minuteBox, "ë¶„");
        setupEditableTimeBox(secondBox, "ì´ˆ");
    
        let alarmSound = null;
        alarmInput.addEventListener("change", event => {
            const file = event.target.files[0];
            if (file) {
                alarmSound = new Audio(URL.createObjectURL(file));
                alarmSound.load();
                alert("âœ… ì•ŒëŒ ì†Œë¦¬ íŒŒì¼ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!");
            }
        });
    
        const changeStates = {
            "íƒ€ì´ë¨¸1": { timeLeft: 10, running: false },
            "íƒ€ì´ë¨¸2": { timeLeft: 20, running: false },
            "íƒ€ì´ë¨¸3": { timeLeft: 30, running: false }
        };
    
        let currentChange = "íƒ€ì´ë¨¸1";
        let totalTime = 10;
        let timeLeft = totalTime;
        let timerInterval = null;
    
        function updateProgress() {
            const percent = (1 - timeLeft / totalTime) * 100;
            fillCircle.style.background = `conic-gradient(#f0f0f0 ${percent}%, #CFDFFF ${percent}%)`;
        }
    
        function updateDisplay() {
            const time = Math.max(0, Math.floor(timeLeft));
            const hours = Math.floor(time / 3600);
            const minutes = Math.floor((time % 3600) / 60);
            const seconds = time % 60;
        
            timerDisplay.textContent = 
                `${String(hours).padStart(2, '0')}:` +
                `${String(minutes).padStart(2, '0')}:` +
                `${String(seconds).padStart(2, '0')}`;
        
            updateProgress();
        }

        function stopTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
            changeStates[currentChange].running = false;
            changeStates[currentChange].timeLeft = timeLeft;
            stopButton.classList.add("hidden");
            playButton.classList.remove("hidden");
        }
    
        function resetTimer() {
            stopTimer();
            timeLeft = totalTime;
            updateDisplay();
            changeStates[currentChange].timeLeft = timeLeft;
        }
    
        function startTimer(resume = false) {
            playButton.classList.add("hidden");
            stopButton.classList.remove("hidden");
            changeStates[currentChange].running = true;
    
            const startTime = performance.now() - (totalTime - timeLeft) * 1000;
            timerInterval = setInterval(() => {
                const now = performance.now();
                const elapsed = (now - startTime) / 1000;
                timeLeft = totalTime - elapsed;
    
                if (timeLeft <= 0) {
                    stopTimer();
                    timeLeft = 0;
                    updateDisplay();
                    if (alarmSound) alarmSound.play();
                    alert("â° ì‹œê°„ì´ ëë‚¬ìŠµë‹ˆë‹¤!");
                    alarmSound.pause();
                    alarmSound.currentTime = 0;
                    return;
                }
    
                updateDisplay();
            }, 50);
        }
    
        function switchChange(change) {
            if (currentChange === change) return;
    
            if (timerInterval !== null) stopTimer();
    
            changeStates[currentChange].timeLeft = timeLeft;
            changeStates[currentChange].running = (timerInterval !== null);
    
            currentChange = change;
            totalTime = parseInt(document.querySelector(`[data-change="${change}"]`).dataset.time);
            timeLeft = changeStates[change].timeLeft;
    
            updateDisplay();
    
            if (changeStates[change].running) {
                startTimer(true);
            }
        }

        console.log(timerText); // null ì•„ë‹ˆë©´ OK

        timerText.addEventListener("click", () => {
            console.log("íƒ€ì´ë¨¸ í´ë¦­ë¨");
            openTimeSetting();
        });

        playButton.addEventListener("click", () => startTimer());
        stopButton.addEventListener("click", stopTimer);
        resetButton.addEventListener("click", resetTimer);
    
        document.querySelectorAll(".change-btn").forEach(btn => {
            btn.addEventListener("click", () => {
                document.querySelectorAll(".change-btn").forEach(otherBtn => {
                    otherBtn.classList.remove("bg-white", "shadow", "rounded-lg");
                    otherBtn.classList.add("bg-transparent");
                });
                btn.classList.add("bg-white", "shadow", "rounded-lg");
                btn.classList.remove("bg-transparent");
    
                switchChange(btn.dataset.change);
            });
        });
    
        updateDisplay();
    </script>
</body>
</html>
